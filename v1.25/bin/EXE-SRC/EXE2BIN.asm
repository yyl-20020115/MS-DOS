

;
; +-------------------------------------------------------------------------+
; |   This file has been generated by The Interactive Disassembler (IDA)    |
; |           Copyright (c) 2017 Hex-Rays, <support@hex-rays.com>           |
; |                      License info: 48-3FBD-7F04-2C                      |
; |                      Jiang Ying, Personal license                       |
; +-------------------------------------------------------------------------+
;
; Input SHA256 : 143F77D8BA0747B1F15FFC35DC33011BEBC98E6CA8530B2E4D6367EDDAB930E9
; Input MD5    : 97D848F6216DFB22428793E8F09877FF
; Input CRC32  : B5ED7323

; File Name   : D:\Working\MS-DOS\v1.25\bin\EXE-SRC\EXE2BIN.EXE
; Format      : MS-DOS executable (EXE)
; Base Address: 1000h Range: 10000h-10351h Loaded length: 2CCh
; Entry Point : 1000:0

                .8086
                ;.model large

; ===========================================================================

; Segment type: Pure code
seg000          segment byte public 'CODE'
                assume cs:seg000
                assume es:nothing, ss:seg002, ds:nothing

; =============== S U B R O U T I N E =======================================


                public start
start           proc far
                mov     si, 81h
                mov     di, 9Bh
                push    ds
                xor     ax, ax
                push    ax
                mov     bx, ds:2
                mov     dx, seg seg001
                mov     es, dx
                assume es:seg001
                mov     ax, 2909h
                int     21h             ; DOS - PARSE FILENAME
                                        ; DS:SI -> string to parse
                                        ; ES:DI -> buffer to fill with unopened FCB
                                        ; AL = bit mask to control parsing
                push    si
                push    ds
                mov     si, 9Bh
                mov     di, 0C0h
                mov     ds, dx
                assume ds:nothing
                mov     cx, 9
                rep movsb
                pop     ds
                pop     si
                mov     di, 0C0h
                mov     ax, 290Fh
                int     21h             ; DOS - PARSE FILENAME
                                        ; DS:SI -> string to parse
                                        ; ES:DI -> buffer to fill with unopened FCB
                                        ; AL = bit mask to control parsing
                mov     ds, dx
                mov     ah, 0Fh
                mov     dx, 9Bh
                int     21h             ; DOS - OPEN DISK FILE
                                        ; DS:DX -> FCB
                                        ; Return: AL = 00h file found, FFh file not found
                or      al, al
                jz      short loc_10050
                mov     dx, 0Ah

loc_10041:                              ; CODE XREF: start+49↓j
                                        ; start:loc_1004E↓j ...
                mov     ah, 9
                int     21h             ; DOS - PRINT STRING
                                        ; DS:DX -> string terminated by "$"
                ret
; ---------------------------------------------------------------------------

loc_10046:                              ; CODE XREF: start+78↓j
                                        ; start+92↓j ...
                mov     dx, 19h
                jmp     short loc_10041
; ---------------------------------------------------------------------------

loc_1004B:                              ; CODE XREF: start+6D↓j
                                        ; start+150↓j ...
                mov     dx, 82h

loc_1004E:                              ; CODE XREF: start:loc_100CA↓j
                jmp     short loc_10041
; ---------------------------------------------------------------------------

loc_10050:                              ; CODE XREF: start+3C↑j
                mov     dx, 0ECh
                mov     ah, 1Ah
                int     21h             ; DOS - SET DISK TRANSFER AREA ADDRESS
                                        ; DS:DX -> disk transfer buffer
                mov     word ptr ds:0A9h, 1
                mov     cx, 1Ah
                mov     dx, 9Bh
                mov     ah, 27h
                int     21h             ; DOS - RANDOM BLOCK READ
                                        ; DS:DX -> FCB
                                        ; CX = number of records to be read
                cmp     word ptr ds:0ECh, 5A4Dh
                jnz     short loc_1004B
                mov     ax, ds:0F4h
                add     ax, 1Fh
                cmp     ax, 1000h
                jnb     short loc_10046
                and     ax, 0FFE0h
                mov     cl, 4
                shl     ax, cl
                mov     ds:0BCh, ax
                xchg    al, ah
                shr     ax, 1
                mov     dx, ds:0F0h
                sub     dx, ax
                cmp     dx, 80h ; '€'
                jnb     short loc_10046
                xchg    dh, dl
                shl     dx, 1
                mov     ax, ds:0EEh
                or      ax, ax
                jz      short loc_100AA
                cmp     ax, 4
                jz      short loc_100AA
                sub     dx, 200h
                add     dx, ax

loc_100AA:                              ; CODE XREF: start+9D↑j
                                        ; start+A2↑j
                mov     ds:0F0h, dx
                add     dx, 0Fh
                shr     dx, cl
                mov     bp, seg seg003
                add     dx, bp
                cmp     dx, bx
                ja      short loc_10046
                mov     dx, 82h
                mov     ax, ds:0FAh
                or      ax, ds:0FCh
                or      ax, ds:102h

loc_100CA:                              ; CODE XREF: start+D6↓j
                                        ; start+E5↓j
                jnz     short loc_1004E
                mov     ax, ds:100h
                or      ax, ax
                jz      short loc_100E7
                cmp     ax, 100h
                jnz     short loc_100CA
                inc     byte ptr ds:0BDh
                sub     ds:0F0h, ax
                cmp     word ptr ds:0F2h, 0
                jnz     short loc_100CA

loc_100E7:                              ; CODE XREF: start+D1↑j
                xor     bx, bx
                cmp     word ptr ds:0F2h, 0
                jz      short loc_10135

loc_100F0:                              ; CODE XREF: start+10C↓j
                                        ; start+133↓j
                mov     dx, 59h ; 'Y'
                mov     ah, 9
                int     21h             ; DOS - PRINT STRING
                                        ; DS:DX -> string terminated by "$"
                mov     ah, 0Ah
                mov     dx, 0E5h
                int     21h             ; DOS - BUFFERED KEYBOARD INPUT
                                        ; DS:DX -> buffer
                mov     dx, 7Fh
                mov     ah, 9
                int     21h             ; DOS - PRINT STRING
                                        ; DS:DX -> string terminated by "$"
                mov     si, 0E7h
                mov     byte ptr [si-1], 0
                jz      short loc_100F0

loc_1010E:                              ; CODE XREF: start+12D↓j
                lodsb
                sub     al, 30h ; '0'
                jb      short loc_1012F
                cmp     al, 0Ah
                jb      short loc_10123
                and     al, 5Fh
                sub     al, 7
                cmp     al, 0Ah
                jb      short loc_1012F
                cmp     al, 10h
                jnb     short loc_1012F

loc_10123:                              ; CODE XREF: start+115↑j
                shl     bx, 1
                shl     bx, 1
                shl     bx, 1
                shl     bx, 1
                or      bl, al
                jmp     short loc_1010E
; ---------------------------------------------------------------------------

loc_1012F:                              ; CODE XREF: start+111↑j
                                        ; start+11D↑j ...
                cmp     byte ptr [si-1], 0Dh
                jnz     short loc_100F0

loc_10135:                              ; CODE XREF: start+EE↑j
                xchg    bx, bp
                push    ds
                mov     ds, bx
                xor     dx, dx
                mov     ah, 1Ah
                int     21h             ; DOS - SET DISK TRANSFER AREA ADDRESS
                                        ; DS:DX -> disk transfer buffer
                pop     ds
                mov     cx, ds:0F0h
                mov     dx, 9Bh
                mov     ah, 27h
                int     21h             ; DOS - RANDOM BLOCK READ
                                        ; DS:DX -> FCB
                                        ; CX = number of records to be read
                or      al, al
                jz      short loc_10153
                jmp     loc_1004B
; ---------------------------------------------------------------------------

loc_10153:                              ; CODE XREF: start+14E↑j
                cmp     word ptr ds:0F2h, 0
                jz      short loc_1018C
                mov     ax, ds:104h
                mov     ds:0BCh, ax
                mov     dx, 0ECh
                mov     ah, 1Ah
                int     21h             ; DOS - SET DISK TRANSFER AREA ADDRESS
                                        ; DS:DX -> disk transfer buffer

loc_10167:                              ; CODE XREF: start+18A↓j
                mov     ah, 27h ; '''
                mov     dx, 9Bh
                mov     cx, 4
                int     21h             ; DOS - RANDOM BLOCK READ
                                        ; DS:DX -> FCB
                                        ; CX = number of records to be read
                or      al, al
                jz      short loc_10178
                jmp     loc_1004B
; ---------------------------------------------------------------------------

loc_10178:                              ; CODE XREF: start+173↑j
                mov     di, ds:0ECh
                mov     ax, ds:0EEh
                add     ax, bx
                mov     es, ax
                assume es:nothing
                add     es:[di], bp
                dec     word ptr ds:0F2h
                jnz     short loc_10167

loc_1018C:                              ; CODE XREF: start+158↑j
                mov     ah, 16h
                mov     dx, 0C0h
                int     21h             ; DOS - CREATE A DISK FILE
                                        ; DS:DX -> FCB
                or      al, al
                jnz     short loc_101C4
                push    ds
                mov     ds, bx
                xor     dx, dx
                mov     ah, 1Ah
                int     21h             ; DOS - SET DISK TRANSFER AREA ADDRESS
                                        ; DS:DX -> disk transfer buffer
                pop     ds
                mov     word ptr ds:0CEh, 1
                mov     cx, ds:0F0h
                mov     dx, 0C0h
                mov     ah, 28h
                int     21h             ; DOS - RANDOM BLOCK WRITE
                                        ; DS:DX -> FCB
                                        ; CX = number of records to be written
                                        ; if zero, truncate file to current random file position
                or      al, al
                jnz     short loc_101BE
                mov     ah, 10h
                mov     dx, 0C0h
                int     21h             ; DOS - CLOSE DISK FILE
                                        ; DS:DX -> FCB
                                        ; Return: AL = 00h directory update successful
                                        ; FFh file not found in directory
                ret
; ---------------------------------------------------------------------------

loc_101BE:                              ; CODE XREF: start+1B4↑j
                mov     dx, 41h ; 'A'
                jmp     loc_10041
; ---------------------------------------------------------------------------

loc_101C4:                              ; CODE XREF: start+195↑j
                mov     dx, 2Dh ; '-'
                jmp     loc_10041
start           endp ; sp-analysis failed

seg000          ends

; ===========================================================================

; Segment type: Regular
seg001          segment byte public 'UNK'
                assume cs:seg001
                ;org 0Ah
                assume es:nothing, ss:nothing, ds:nothing
aFileNotFoundIn db 'File not found$Insufficient memory$File creation error$Insufficie'
                db 'nt disk space$Fix-ups needed - base segment (hex): $',0Dh,0Ah
                db '$File cannot be converted$',0
aExe            db '        EXE',0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db  20h
                db  20h
                db  20h
                db  20h
                db  20h
                db  20h
                db  20h
                db  20h
                db  42h ; B
                db  49h ; I
                db  4Eh ; N
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    5
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    0
                db    ? ;
                db    ? ;
                db    ? ;
                db    ? ;
seg001          ends

; ===========================================================================

; Segment type: Uninitialized
seg002          segment byte stack 'STACK'
                assume cs:seg002
                assume es:nothing, ss:nothing, ds:nothing
                db 80h dup(?)
seg002          ends

; ===========================================================================

; Segment type: Zero-length
seg003          segment byte public '_'
seg003          ends
                end start
